# ğŸ“Š Phase 5: Grafana å„€è¡¨æ¿è¨­è¨ˆå®Œæˆæ‘˜è¦

## ğŸ¯ è¨­è¨ˆç›®æ¨™

å‰µå»ºä¸€å€‹ **ç›´è§€ã€ç¾è§€ã€å¯¦ç”¨** çš„ç›£æ§å„€è¡¨æ¿ï¼Œèƒ½å¤ ï¼š
- âœ… ä¸€çœ¼çœ‹å‡ºç³»çµ±å¥åº·ç‹€æ…‹
- âœ… å¿«é€Ÿå®šä½æ•ˆèƒ½ç“¶é ¸
- âœ… è¿½è¹¤éŒ¯èª¤è¶¨å‹¢
- âœ… æä¾›æ­·å²æ•¸æ“šåˆ†æ

---

## ğŸ¨ å„€è¡¨æ¿è¦–è¦ºè¨­è¨ˆ

### ä½ˆå±€çµæ§‹ï¼ˆ3 å±¤å¼è¨­è¨ˆï¼‰

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ  ç¬¬ä¸€å±¤ï¼šç³»çµ±å¥åº·åº¦å¿«é€Ÿæª¢è¦– (Quick Health Check)   â”ƒ
â”£â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”«
â”ƒ CPU    â”ƒ Memory â”ƒ   HTTP Request Rate          â”ƒ
â”ƒ ä½¿ç”¨ç‡  â”ƒ ä½¿ç”¨é‡  â”ƒ   (Requests per Second)      â”ƒ
â”ƒ ğŸŸ¢ 12% â”ƒ ğŸŸ¢ 60MBâ”ƒ   ğŸ“ˆ ç·šåœ–é¡¯ç¤ºå³æ™‚æµé‡         â”ƒ
â”ƒ Gauge  â”ƒ Gauge  â”ƒ   Time Series                â”ƒ
â”£â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”«
â”ƒ  ç¬¬äºŒå±¤ï¼šæ•ˆèƒ½åˆ†æ (Performance Analysis)          â”ƒ
â”£â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”«
â”ƒ HTTP Response Time  â”ƒ   HTTP Error Rate        â”ƒ
â”ƒ P50: 10ms           â”ƒ   5xx: ğŸ”´ 0.5%          â”ƒ
â”ƒ P95: 50ms           â”ƒ   4xx: ğŸŸ¡ 2.1%          â”ƒ
â”ƒ ğŸ“Š é›™ç·šåœ–            â”ƒ   ğŸ“Š å †ç–Šé¢ç©åœ–          â”ƒ
â”£â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”«
â”ƒ  ç¬¬ä¸‰å±¤ï¼šè©³ç´°çµ±è¨ˆ (Detailed Statistics)           â”ƒ
â”£â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”«
â”ƒ Active â”ƒ Total  â”ƒ   Status Code Distribution   â”ƒ
â”ƒ Requestsâ”ƒRequestsâ”ƒ   200: 85%  ğŸŸ¢              â”ƒ
â”ƒ ğŸŸ¢ 3   â”ƒ 1,234  â”ƒ   404: 10%  ğŸŸ¡              â”ƒ
â”ƒ Gauge  â”ƒ Stat   â”ƒ   500: 5%   ğŸ”´   åœ“é¤…åœ–      â”ƒ
â”—â”â”â”â”â”â”â”â”â”»â”â”â”â”â”â”â”â”â”»â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
```

---

## ğŸ“ˆ 8 å€‹æ ¸å¿ƒ Panel è¨­è¨ˆ

### Panel 1: CPU ä½¿ç”¨ç‡ âš™ï¸
- **é¡å‹**: Gauge (å„€è¡¨æ¿)
- **æŒ‡æ¨™**: `process_cpu_user_seconds_total`
- **é–¾å€¼**:
  - ğŸŸ¢ 0-80%: æ­£å¸¸
  - ğŸ”´ 80-100%: å±éšª
- **ä½ç½®**: å·¦ä¸Šè§’
- **å°ºå¯¸**: 6 æ¬„ Ã— 8 è¡Œ

### Panel 2: è¨˜æ†¶é«”ä½¿ç”¨é‡ ğŸ’¾
- **é¡å‹**: Gauge
- **æŒ‡æ¨™**: `process_resident_memory_bytes`
- **é–¾å€¼**:
  - ğŸŸ¢ < 50MB: æ­£å¸¸
  - ğŸŸ¡ 50-100MB: è­¦å‘Š
  - ğŸ”´ > 100MB: å±éšª
- **ä½ç½®**: å·¦ä¸­
- **å°ºå¯¸**: 6 æ¬„ Ã— 8 è¡Œ

### Panel 3: HTTP è«‹æ±‚ç‡ ğŸ“Š
- **é¡å‹**: Time Series (æ™‚é–“åºåˆ—åœ–)
- **æŒ‡æ¨™**: `rate(http_requests_total[1m])`
- **åˆ†çµ„**: ä¾ route å’Œ method
- **åœ–ä¾‹**: é¡¯ç¤ºå¹³å‡å€¼å’Œæœ€å¤§å€¼
- **ä½ç½®**: å³ä¸Š
- **å°ºå¯¸**: 12 æ¬„ Ã— 8 è¡Œ

### Panel 4: HTTP å›æ‡‰æ™‚é–“ â±ï¸
- **é¡å‹**: Time Series
- **æŒ‡æ¨™**:
  - P95: `histogram_quantile(0.95, http_request_duration_ms_bucket)`
  - P50: `histogram_quantile(0.50, http_request_duration_ms_bucket)`
- **èªªæ˜**:
  - P50 ä»£è¡¨ä¸­ä½æ•¸ï¼ˆ50% ç”¨æˆ¶çš„é«”é©—ï¼‰
  - P95 ä»£è¡¨å°¾ç«¯å»¶é²ï¼ˆæœ€æ…¢ 5% çš„é«”é©—ï¼‰
- **ä½ç½®**: å·¦ä¸­
- **å°ºå¯¸**: 12 æ¬„ Ã— 8 è¡Œ

### Panel 5: HTTP éŒ¯èª¤ç‡ âŒ
- **é¡å‹**: Stacked Area (å †ç–Šé¢ç©åœ–)
- **æŒ‡æ¨™**:
  - 5xx: ä¼ºæœå™¨éŒ¯èª¤ (ğŸ”´ ç´…è‰²)
  - 4xx: å®¢æˆ¶ç«¯éŒ¯èª¤ (ğŸŸ¡ é»ƒè‰²)
- **è¨ˆç®—**: `100 * errors / total_requests`
- **ä½ç½®**: å³ä¸­
- **å°ºå¯¸**: 12 æ¬„ Ã— 8 è¡Œ

### Panel 6: æ´»èºè«‹æ±‚æ•¸ ğŸ”„
- **é¡å‹**: Gauge
- **æŒ‡æ¨™**: `http_requests_active`
- **é–¾å€¼**:
  - ğŸŸ¢ 0-5: æ­£å¸¸
  - ğŸŸ¡ 5-10: è­¦å‘Š
  - ğŸ”´ > 10: é«˜è² è¼‰
- **ä½ç½®**: å·¦ä¸‹
- **å°ºå¯¸**: 6 æ¬„ Ã— 8 è¡Œ

### Panel 7: ç¸½è«‹æ±‚æ•¸ ğŸ“ˆ
- **é¡å‹**: Stat (çµ±è¨ˆæ•¸å­—)
- **æŒ‡æ¨™**: `sum(increase(http_requests_total[1h]))`
- **æ™‚é–“ç¯„åœ**: éå» 1 å°æ™‚
- **é¡¯ç¤º**: å¤§æ•¸å­— + è¶¨å‹¢åœ–
- **ä½ç½®**: ä¸­ä¸‹
- **å°ºå¯¸**: 6 æ¬„ Ã— 8 è¡Œ

### Panel 8: HTTP ç‹€æ…‹ç¢¼åˆ†ä½ˆ ğŸ¥§
- **é¡å‹**: Pie Chart (åœ“é¤…åœ–)
- **æŒ‡æ¨™**: `sum(increase(http_requests_total[1h])) by (status_code)`
- **é¡¯ç¤º**: ç™¾åˆ†æ¯” + æ•¸å€¼
- **åœ–ä¾‹**: å³å´è¡¨æ ¼
- **ä½ç½®**: å³ä¸‹
- **å°ºå¯¸**: 12 æ¬„ Ã— 8 è¡Œ

---

## ğŸ¨ è¨­è¨ˆåŸå‰‡èªªæ˜

### 1. é¡è‰²èªæ„å­¸ (Color Semantics)

æˆ‘å€‘æ¡ç”¨é€šç”¨çš„ç´…ç¶ ç‡ˆé…è‰²ç³»çµ±ï¼š

| é¡è‰² | HEX Code | èªæ„ | ä½¿ç”¨æƒ…å¢ƒ |
|------|----------|------|---------|
| ğŸŸ¢ ç¶ è‰² | #73BF69 | æ­£å¸¸/å®‰å…¨ | CPU < 80%, ç„¡éŒ¯èª¤, æ­£å¸¸å›æ‡‰æ™‚é–“ |
| ğŸŸ¡ é»ƒè‰² | #FADE2A | è­¦å‘Š/æ³¨æ„ | CPU 80-90%, 4xx éŒ¯èª¤, å»¶é²å‡é«˜ |
| ğŸ”´ ç´…è‰² | #F2495C | å±éšª/éŒ¯èª¤ | CPU > 90%, 5xx éŒ¯èª¤, ç³»çµ±æ•…éšœ |
| ğŸ”µ è—è‰² | #5794F2 | è³‡è¨Š/ä¸­æ€§ | ä¸€èˆ¬æ•¸æ“šè¶¨å‹¢ |

### 2. è³‡è¨Šå±¤æ¬¡ (Information Hierarchy)

```
å„ªå…ˆç´š 1 (First Glance - 3 ç§’å…§)
  â””â”€> CPU, è¨˜æ†¶é«”, æ´»èºè«‹æ±‚
      ã€Œç³»çµ±æ­£å¸¸å—ï¼Ÿã€

å„ªå…ˆç´š 2 (Quick Analysis - 10 ç§’å…§)
  â””â”€> è«‹æ±‚ç‡, éŒ¯èª¤ç‡è¶¨å‹¢
      ã€Œæœ‰ç•°å¸¸ç™¼ç”Ÿå—ï¼Ÿã€

å„ªå…ˆç´š 3 (Deep Dive - 30 ç§’å…§)
  â””â”€> å›æ‡‰æ™‚é–“ç™¾åˆ†ä½, ç‹€æ…‹ç¢¼åˆ†ä½ˆ
      ã€Œæ•ˆèƒ½ç“¶é ¸åœ¨å“ªï¼Ÿã€
```

### 3. è¦–è¦ºå¹³è¡¡ (Visual Balance)

- **å°ç¨±æ€§**: å·¦å³é¢æ¿æ•¸é‡å¹³è¡¡ï¼ˆ3-3 é…ç½®ï¼‰
- **å¯†åº¦**: ä¸Šæ–¹è¼ƒå¯†é›†ï¼ˆå¿«é€Ÿæª¢è¦–ï¼‰ï¼Œä¸‹æ–¹è¼ƒç¨€ç–ï¼ˆè©³ç´°åˆ†æï¼‰
- **ç•™ç™½**: Panel ä¹‹é–“æœ‰é©ç•¶é–“è·ï¼Œä¸æ“æ“ 

### 4. èªçŸ¥è² è·æœ€å°åŒ–

- **ä¸€è‡´æ€§**: ç›¸åŒé¡å‹çš„æŒ‡æ¨™ä½¿ç”¨ç›¸åŒåœ–è¡¨é¡å‹
- **æ¼¸é€²å¼æ­éœ²**: å¾æ‘˜è¦åˆ°ç´°ç¯€ï¼Œå±¤æ¬¡åˆ†æ˜
- **æ¸›å°‘å¹²æ“¾**: ä¸å¿…è¦çš„è£é£¾å…ƒç´ éƒ½ç§»é™¤

---

## ğŸ”§ æŠ€è¡“å¯¦ä½œç´°ç¯€

### PromQL æŸ¥è©¢å„ªåŒ–

#### 1. ä½¿ç”¨ Rate è€Œé Increase
```promql
# âŒ ä¸å¥½ï¼šincrease çµæœæœƒéš¨æ™‚é–“ç¯„åœè®ŠåŒ–
increase(http_requests_total[1m])

# âœ… å¥½ï¼šrate æ¨™æº–åŒ–ç‚ºæ¯ç§’é€Ÿç‡
rate(http_requests_total[1m])
```

#### 2. é©ç•¶çš„æ™‚é–“çª—å£
```promql
# çŸ­æœŸè¶¨å‹¢ï¼š1-5 åˆ†é˜
rate(http_requests_total[1m])

# é•·æœŸè¶¨å‹¢ï¼š5-15 åˆ†é˜
rate(http_requests_total[5m])
```

#### 3. ç™¾åˆ†ä½æ•¸è¨ˆç®—
```promql
# P95 å›æ‡‰æ™‚é–“
histogram_quantile(
  0.95,
  sum(rate(http_request_duration_ms_bucket[5m])) by (le, route)
)
```

### Grafana é…ç½®å„ªåŒ–

#### è‡ªå‹•åˆ·æ–°ç­–ç•¥
```json
{
  "refresh": "5s",  // 5 ç§’åˆ·æ–°ä¸€æ¬¡
  "time": {
    "from": "now-30m",  // é¡¯ç¤ºæœ€è¿‘ 30 åˆ†é˜
    "to": "now"
  }
}
```

#### Legend è¨­å®š
```json
{
  "legend": {
    "displayMode": "table",  // è¡¨æ ¼æ¨¡å¼
    "placement": "bottom",   // æ”¾åœ¨ä¸‹æ–¹
    "showLegend": true,
    "calcs": ["mean", "max", "lastNotNull"]  // é¡¯ç¤ºçµ±è¨ˆå€¼
  }
}
```

---

## ğŸ“Š å„€è¡¨æ¿æ•ˆèƒ½è€ƒé‡

### 1. æŸ¥è©¢æ•ˆèƒ½
- âœ… ä½¿ç”¨ `sum by (label)` æ¸›å°‘æ™‚é–“åºåˆ—æ•¸é‡
- âœ… é¿å…éé•·çš„æ™‚é–“ç¯„åœï¼ˆ30 åˆ†é˜è¶³å¤ ï¼‰
- âœ… ä½¿ç”¨é©ç•¶çš„ scrape intervalï¼ˆ10 ç§’ï¼‰

### 2. è¦–è¦ºæ•ˆèƒ½
- âœ… é™åˆ¶æ¯å€‹ panel çš„ç·šæ¢æ•¸é‡ï¼ˆ< 10 æ¢ï¼‰
- âœ… ä½¿ç”¨ 5 ç§’è‡ªå‹•åˆ·æ–°ï¼ˆä¸æœƒå¤ªé »ç¹ï¼‰
- âœ… æ·±è‰²ä¸»é¡Œæ¸›å°‘è¢å¹•è€—é›»

### 3. ä½¿ç”¨è€…é«”é©—
- âœ… æ‰€æœ‰é‡è¦è³‡è¨Šåœ¨é¦–å±å¯è¦‹ï¼ˆç„¡éœ€æ»¾å‹•ï¼‰
- âœ… Tooltip æä¾›è©³ç´°æ•¸æ“š
- âœ… åœ–ä¾‹ä½ç½®ä¸é®æ“‹åœ–è¡¨

---

## ğŸ¯ è¨­è¨ˆæˆæœ

### é”æˆçš„ç›®æ¨™

1. âœ… **ç›´è§€æ€§**: 3 ç§’å…§äº†è§£ç³»çµ±å¥åº·ç‹€æ…‹
2. âœ… **ç¾è§€æ€§**: å°ˆæ¥­çš„æ·±è‰²ä¸»é¡Œï¼Œè¦–è¦ºèˆ’é©
3. âœ… **å¯¦ç”¨æ€§**: 8 å€‹ Panel æ¶µè“‹æ‰€æœ‰é—œéµæŒ‡æ¨™
4. âœ… **å¯ç¶­è­·æ€§**: JSON é…ç½®æ˜“æ–¼ä¿®æ”¹å’Œæ“´å±•

### Golden Signals è¦†è“‹

| Signal | Panel | Metric |
|--------|-------|--------|
| ğŸ¯ Latency | Panel 4 | HTTP å›æ‡‰æ™‚é–“ P50/P95 |
| ğŸš¦ Traffic | Panel 3 | HTTP è«‹æ±‚ç‡ |
| âŒ Errors | Panel 5 | HTTP éŒ¯èª¤ç‡ 4xx/5xx |
| ğŸ“Š Saturation | Panel 1, 2 | CPU & è¨˜æ†¶é«”ä½¿ç”¨ç‡ |

---

## ğŸ“ æª”æ¡ˆçµæ§‹

```
TixMaster/
â”œâ”€â”€ prometheus.yml                          # Prometheus é…ç½®
â”œâ”€â”€ docker-compose.monitoring.yml           # Docker Compose
â”œâ”€â”€ grafana/
â”‚   â”œâ”€â”€ provisioning/
â”‚   â”‚   â”œâ”€â”€ datasources/
â”‚   â”‚   â”‚   â””â”€â”€ prometheus.yml             # è‡ªå‹•é…ç½®è³‡æ–™æº
â”‚   â”‚   â””â”€â”€ dashboards/
â”‚   â”‚       â””â”€â”€ dashboard.yml              # Dashboard provisioning
â”‚   â””â”€â”€ dashboards/
â”‚       â””â”€â”€ tixmaster-overview.json        # ä¸»è¦å„€è¡¨æ¿ JSON
â””â”€â”€ markdown_file/
    â”œâ”€â”€ MONITORING_SETUP_GUIDE.md          # å®Œæ•´è¨­å®šæŒ‡å—
    â””â”€â”€ PHASE5_DASHBOARD_DESIGN_SUMMARY.md # æœ¬æ–‡ä»¶
```

---

## ğŸš€ ä¸‹ä¸€æ­¥

- âœ… Phase 5 å®Œæˆï¼
- ğŸ”œ Phase 6: ç¹ªè£½ç³»çµ±æ¶æ§‹åœ–
- ğŸ”œ Phase 7: è¨­å®šè­¦å ±è¦å‰‡
- ğŸ”œ Phase 8: æ’°å¯« SLI/SLO/SLA æ–‡ä»¶

---

## ğŸ’¡ ä½¿ç”¨æç¤º

### å¦‚ä½•å•Ÿå‹•å„€è¡¨æ¿

```bash
# 1. å•Ÿå‹• Backend
cd backend && npm start

# 2. å•Ÿå‹•ç›£æ§ç³»çµ±
docker-compose -f docker-compose.monitoring.yml up -d

# 3. é–‹å•Ÿ Grafana
open http://localhost:3001
# å¸³è™Ÿ: admin / admin

# 4. ç”¢ç”Ÿæ¸¬è©¦æµé‡
for i in {1..50}; do curl http://localhost:3000/health && sleep 1; done
```

### å¸¸ç”¨ Grafana å¿«æ·éµ

- `d` + `s`: å„²å­˜å„€è¡¨æ¿
- `d` + `k`: é–‹å•Ÿæ™‚é–“é¸æ“‡å™¨
- `Esc`: é—œé–‰è¨­å®šé¢æ¿
- `?`: é¡¯ç¤ºæ‰€æœ‰å¿«æ·éµ

---

**Phase 5 å®Œæˆæ—¥æœŸ**: 2025-11-30
**è¨­è¨ˆè€…**: TixMaster åœ˜éšŠ ğŸ‰
